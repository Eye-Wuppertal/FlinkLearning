## Standalone-HA高可用集群模式

### 原理

![image-20211027161656568](.\img\image-20211027161656568.png)

### 步骤

1.集群规划

\- 服务器: master(Master + Slave): JobManager + TaskManager

\- 服务器: slave1(Master + Slave): JobManager + TaskManager

\- 服务器: slave2(Slave): TaskManager

2.启动ZooKeeper

```shell
zkServer.sh status
zkServer.sh stop
zkServer.sh start
# 三个服务器要同时打开！！
```

3.启动HDFS

```shell
start-dfs.sh
```

4.停止Flink集群

```shell
stop-cluster.sh
```

5.修改flink-conf.yaml

```shell
vi /software/flink/conf/flink-conf.yaml
```



增加如下内容

```shell
state.backend: filesystem
state.backend.fs.checkpointdir: hdfs://master:9000/flink-checkpoints
high-availability: zookeeper
high-availability.storageDir: hdfs://master:9000/flink/ha/
high-availability.zookeeper.quorum: master:2181,slave1:2181,slave2:2181
```

6.修改masters

```shell
vi /software/flink/conf/masters

master:8081
slave1:8081
```

7.同步

```shell
scp -r /software/flink/conf/flink-conf.yaml slave1:/software/flink/conf/
scp -r /software/flink/conf/flink-conf.yaml slave2:/software/flink/conf/
scp -r /software/flink/conf/masters slave1:/software/flink/conf/
scp -r /software/flink/conf/masters slave2:/software/flink/conf/
```



8.修改slave1上的flink-conf.yaml

```shell
vi /software/flink/conf/flink-conf.yaml

jobmanager.rpc.address: slave1
```



9.重新启动Flink集群,master上执行

```shell
/software/flink/bin/stop-cluster.sh
/software/flink/bin/start-cluster.sh
```

![image-20211027172349791](.\img\image-20211027172349791.png)





 



 


